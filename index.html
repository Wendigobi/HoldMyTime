<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Instant Booking Page â€” Deposit + SMS/Calendar Ready</title>
  <meta name="description" content="One-page booking with deposit. Cut no-shows. Go live in 30 minutes." />
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { --brand:#2563eb; }
    * { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji", sans-serif; }
    .btn { @apply inline-flex items-center justify-center rounded-xl px-4 py-2 font-semibold shadow-sm hover:opacity-95 active:opacity-90 transition; background: var(--brand); color:#fff; }
    .card { @apply rounded-2xl shadow-lg border border-gray-200 bg-white; }
    .field { @apply w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500; }
    .muted { @apply text-sm text-gray-500; }
    .hidden { display:none; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <!-- NAV -->
  <header class="max-w-5xl mx-auto px-4 py-6 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <div class="w-8 h-8 rounded-xl bg-blue-600"></div>
      <span class="font-extrabold text-lg">InstantBooking</span>
    </div>
    <nav class="hidden sm:flex items-center gap-6">
      <a href="#home" class="hover:underline">Home</a>
      <a href="#book" class="hover:underline">Book</a>
      <a href="#faq" class="hover:underline">FAQ</a>
    </nav>
    <a href="#book" class="btn">Book now</a>
  </header>

  <!-- MAIN -->
  <main class="max-w-5xl mx-auto px-4 pb-20">
    <!-- HERO -->
    <section id="home" class="grid md:grid-cols-2 gap-8 items-center">
      <div>
        <h1 class="text-4xl md:text-5xl font-extrabold leading-tight">
          Book more jobs in 24hâ€”<span class="text-blue-600">with a deposit</span>
        </h1>
        <p class="mt-4 text-lg text-gray-600">
          One-page booking with SMS-style confirmations and a small deposit to cut no-shows.
          Launch in 30 minutes. No apps. No logins for your customer.
        </p>
        <div class="mt-6 flex gap-3">
          <a class="btn" href="#book">Start a booking</a>
          <button id="demoFill" class="px-4 py-2 rounded-xl border border-gray-300">Demo autofill</button>
        </div>
        <p class="muted mt-3">Pay the deposit after you pick a time.</p>
      </div>
      <div class="card p-6">
        <div class="rounded-xl bg-gradient-to-br from-blue-50 to-indigo-50 p-6">
          <p class="font-semibold">What you get</p>
          <ul class="mt-3 space-y-2 text-gray-700">
            <li>â€¢ Customer picks a time in seconds</li>
            <li>â€¢ Stripe deposit checkout</li>
            <li>â€¢ Instant confirmation + calendar file</li>
            <li>â€¢ You get booking details in the return screen</li>
          </ul>
        </div>
        <div class="mt-6 grid grid-cols-3 gap-3">
          <div class="card p-4 text-center">
            <div class="text-2xl font-extrabold">-70%</div>
            <div class="muted">No-shows</div>
          </div>
          <div class="card p-4 text-center">
            <div class="text-2xl font-extrabold">+3Ã—</div>
            <div class="muted">Faster booking</div>
          </div>
          <div class="card p-4 text-center">
            <div class="text-2xl font-extrabold">5 min</div>
            <div class="muted">Setup</div>
          </div>
        </div>
      </div>
    </section>

    <!-- BOOKING -->
    <section id="book" class="mt-16">
      <div class="grid md:grid-cols-5 gap-8">
        <div class="md:col-span-3 card p-6">
          <h2 class="text-2xl font-bold">Book a service</h2>
          <p class="muted mt-1">Pick a time and pay a small deposit to confirm.</p>

          <form id="bookingForm" class="mt-6 space-y-4">
            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Full name</label>
                <input required id="name" class="field" placeholder="Jane Doe" />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Email</label>
                <input required id="email" type="email" class="field" placeholder="jane@example.com" />
              </div>
            </div>

            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Phone</label>
                <input required id="phone" class="field" placeholder="(555) 555-5555" />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Service</label>
                <select required id="service" class="field">
                  <option value="">Selectâ€¦</option>
                  <option>Locksmith â€” Emergency</option>
                  <option>House Cleaning â€” Standard</option>
                  <option>Landscaping â€” Lawn Mow</option>
                  <option>Handyman â€” Hourly</option>
                </select>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium mb-1">Address</label>
              <input required id="address" class="field" placeholder="123 Main St, City, ST" />
            </div>

            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Date</label>
                <input required id="date" type="date" class="field" />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Time</label>
                <input required id="time" type="time" class="field" />
              </div>
            </div>

            <div class="grid sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1">Notes (optional)</label>
                <input id="notes" class="field" placeholder="Gate code, pets, etc." />
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">Deposit</label>
                <select id="deposit" class="field">
                  <option value="25">$25</option>
                  <option value="50">$50</option>
                  <option value="75">$75</option>
                </select>
              </div>
            </div>

            <div class="flex items-center gap-3">
              <button type="submit" class="btn">Pay deposit to confirm</button>
              <span class="muted">Youâ€™ll be redirected to Stripe checkout.</span>
            </div>
          </form>
        </div>

        <aside class="md:col-span-2">
          <div class="card p-6">
            <h3 class="font-bold text-lg">How it works</h3>
            <ol class="mt-3 space-y-2 text-gray-700">
              <li>1) Pick a time & fill details</li>
              <li>2) Pay deposit on Stripe</li>
              <li>3) Youâ€™ll see confirmation + calendar file</li>
            </ol>
            <hr class="my-4" />
            <p class="muted">Weâ€™ll confirm by text/email. Deposits are applied to your final bill.</p>
          </div>
          <div class="card p-6 mt-6">
            <h3 class="font-bold text-lg">Questions?</h3>
            <p class="muted">Call/text: <a id="bizPhoneLink" href="tel:+15555550123" class="text-blue-600">+1 (555) 555-0123</a></p>
            <p class="muted">Email: <a id="bizEmailLink" href="mailto:hello@example.com" class="text-blue-600">hello@example.com</a></p>
          </div>
        </aside>
      </div>
    </section>

    <!-- FAQ -->
    <section id="faq" class="mt-16 card p-6">
      <h2 class="text-2xl font-bold">FAQ</h2>
      <details class="mt-4">
        <summary class="font-semibold cursor-pointer">Why a deposit?</summary>
        <p class="mt-2 text-gray-700">Deposits drastically reduce no-shows and let us hold your slot.</p>
      </details>
      <details class="mt-3">
        <summary class="font-semibold cursor-pointer">Can I reschedule?</summary>
        <p class="mt-2 text-gray-700">Yesâ€”reply to your confirmation or contact us. Weâ€™ll move your appointment.</p>
      </details>
    </section>

    <!-- SUCCESS (shown when URL hash === #success) -->
    <section id="success" class="mt-16 hidden">
      <div class="card p-6">
        <h2 class="text-2xl font-bold text-green-700">Deposit received ðŸŽ‰</h2>
        <p class="mt-2">Thanks, <span id="s_name"></span>! Your <span id="s_service"></span> is booked for <span id="s_datetime"></span> at <span id="s_address"></span>.</p>
        <p class="muted mt-1">We also sent a Stripe receipt to <span id="s_email"></span>.</p>

        <div class="mt-6 grid sm:grid-cols-2 gap-4">
          <a id="dlCustomerIcs" class="btn" download="booking.ics">Add to my calendar (.ics)</a>
          <a id="dlBizIcs" class="px-4 py-2 rounded-xl border border-gray-300 text-center">Download business copy (.ics)</a>
        </div>

        <div class="mt-6">
          <p class="muted">Need to change something? Text us at <a id="s_bizPhone" href="tel:+15555550123" class="text-blue-600">+1 (555) 555-0123</a>.</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="border-t py-8">
    <div class="max-w-5xl mx-auto px-4 flex items-center justify-between">
      <p class="muted">Â© <span id="year"></span> InstantBooking</p>
      <form id="newsletter" class="flex gap-2">
        <input id="nlEmail" type="email" placeholder="Your email" class="field !py-2 !px-3" />
        <button class="btn" type="submit">Get updates</button>
      </form>
    </div>
  </footer>

  <script>
    // ---------- CONFIG: replace these with your business details ----------
    const CONFIG = {
      businessName: "InstantBooking",
      businessPhoneE164: "+15555550123",
      businessEmail: "hello@example.com",
      // Your Stripe Payment Link (create in Stripe Dashboard)
      // IMPORTANT: In Stripe, set the "After payment" redirect URL to your GitHub Pages URL + "#success"
      // e.g., https://yourname.github.io/instant-booking/#success
      paymentLink: "https://buy.stripe.com/test_1234567890abcdef", // <-- REPLACE
      // Optionally lock to one deposit amount by creating separate Payment Links per tier.
    };
    // ---------------------------------------------------------------------

    // Basic router: show #success section when returning from Stripe
    function showSectionFromHash() {
      const success = document.getElementById("success");
      if (location.hash.startsWith("#success")) {
        success.classList.remove("hidden");
        const payload = readPayloadFromStorageOrQuery();
        if (payload) {
          renderSuccess(payload);
        }
        document.getElementById("home").classList.add("hidden");
        document.getElementById("book").classList.add("hidden");
        document.getElementById("faq").classList.add("hidden");
      } else {
        document.getElementById("home").classList.remove("hidden");
        document.getElementById("book").classList.remove("hidden");
        document.getElementById("faq").classList.remove("hidden");
        success.classList.add("hidden");
      }
    }
    window.addEventListener("hashchange", showSectionFromHash);

    // Demo autofill
    document.getElementById("demoFill").addEventListener("click", () => {
      document.getElementById("name").value = "Jamie Client";
      document.getElementById("email").value = "jamie@example.com";
      document.getElementById("phone").value = "(555) 000-1234";
      document.getElementById("address").value = "123 Main St, Austin, TX";
      document.getElementById("service").value = "Locksmith â€” Emergency";
      const d = new Date();
      d.setDate(d.getDate() + 1);
      document.getElementById("date").valueAsDate = d;
      document.getElementById("time").value = "10:00";
      document.getElementById("notes").value = "Please ring the side door.";
      document.getElementById("deposit").value = "50";
    });

    // Newsletter (local-only placeholder)
    document.getElementById("newsletter").addEventListener("submit", (e) => {
      e.preventDefault();
      const email = document.getElementById("nlEmail").value.trim();
      if (!email) return;
      localStorage.setItem("newsletterEmail", email);
      alert("Thanks! Weâ€™ll be in touch.");
      e.target.reset();
    });

    // Booking submit -> Stripe
    document.getElementById("bookingForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const form = {
        name: byId("name"),
        email: byId("email"),
        phone: byId("phone"),
        address: byId("address"),
        service: byId("service"),
        date: byId("date"),
        time: byId("time"),
        notes: byId("notes"),
        deposit: byId("deposit")
      };
      // quick validation
      if (!form.name || !form.email || !form.phone || !form.address || !form.service || !form.date || !form.time) {
        alert("Please complete all required fields.");
        return;
      }
      // build a compact payload
      const booking = {
        name: form.name,
        email: form.email,
        phone: form.phone,
        address: form.address,
        service: form.service,
        date: form.date,
        time: form.time,
        notes: form.notes || "",
        deposit: form.deposit || "25",
        businessPhoneE164: CONFIG.businessPhoneE164,
        businessEmail: CONFIG.businessEmail
      };

      // Save to localStorage so the success screen can read it after redirect
      localStorage.setItem("booking_payload", JSON.stringify(booking));

      // Build Stripe Payment Link with URL params:
      //  - prefilled_email
      //  - client_reference_id (we pass a short, URL-safe summary)
      const shortRef = encodeURIComponent(
        `${booking.service} | ${booking.date} ${booking.time} | ${booking.name}`
      );
      const emailParam = encodeURIComponent(booking.email);

      // NOTE: Ensure your Payment Link in Stripe has "After payment redirect" set to this page + "#success"
      // Example: https://yourname.github.io/instant-booking/#success
      const checkoutUrl = `${CONFIG.paymentLink}?prefilled_email=${emailParam}&client_reference_id=${shortRef}`;

      window.location.href = checkoutUrl;
    });

    function byId(id){ return document.getElementById(id)?.value?.trim(); }

    // On #success, read payload
    function readPayloadFromStorageOrQuery() {
      try {
        const raw = localStorage.getItem("booking_payload");
        if (!raw) return null;
        return JSON.parse(raw);
      } catch { return null; }
    }

    function renderSuccess(b) {
      setText("s_name", b.name);
      setText("s_service", b.service);
      setText("s_email", b.email);
      setText("s_address", b.address);
      const dt = formatReadableDateTime(b.date, b.time);
      setText("s_datetime", dt);
      // phone/e-mail links
      const p = document.getElementById("s_bizPhone");
      if (p) p.href = `tel:${CONFIG.businessPhoneE164}`;
      document.getElementById("bizPhoneLink").href = `tel:${CONFIG.businessPhoneE164}`;
      document.getElementById("bizEmailLink").href = `mailto:${CONFIG.businessEmail}`;

      // Create ICS download links for customer & business
      const start = toISODateTime(b.date, b.time);
      const end = toISODateTime(b.date, addMinutes(b.time, 60)); // default 1 hour
      const title = `${b.service} â€” ${CONFIG.businessName}`;
      const desc = `Appointment for ${b.name} (${b.phone}). Address: ${b.address}. Notes: ${b.notes}.`;
      const loc = b.address;

      const icsCustomer = generateICS({
        title, description: desc,
        startISO: start, endISO: end, location: loc,
        organizer: CONFIG.businessEmail
      });
      const icsBiz = generateICS({
        title: `JOB: ${b.service} â€” ${b.name}`,
        description: `Customer: ${b.name}\nPhone: ${b.phone}\nEmail: ${b.email}\nAddress: ${b.address}\nNotes: ${b.notes}`,
        startISO: start, endISO: end, location: loc,
        organizer: b.email
      });

      document.getElementById("dlCustomerIcs").href = makeBlobUrl(icsCustomer);
      document.getElementById("dlBizIcs").href = makeBlobUrl(icsBiz);

      // clear payload after rendering (optional)
      // localStorage.removeItem("booking_payload");
    }

    function setText(id, text){ const el=document.getElementById(id); if (el) el.textContent = text; }
    function pad(n){ return String(n).padStart(2,"0"); }
    function toISODateTime(dateStr, timeStr){
      // Combine local date+time to UTC-ish string for ICS (no TZ => "floating" time)
      const [yyyy, mm, dd] = dateStr.split("-").map(Number);
      const [hh, mi] = timeStr.split(":").map(Number);
      return `${yyyy}${pad(mm)}${pad(dd)}T${pad(hh)}${pad(mi)}00`;
    }
    function addMinutes(timeStr, mins){
      const [h, m] = timeStr.split(":").map(Number);
      const d = new Date(); d.setHours(h, m + mins, 0, 0);
      return `${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }
    function formatReadableDateTime(dateStr, timeStr){
      const d = new Date(`${dateStr}T${timeStr}:00`);
      return d.toLocaleString([], { dateStyle:"medium", timeStyle:"short" });
    }
    function generateICS({title, description, startISO, endISO, location, organizer}){
      const uid = `${Date.now()}-${Math.random().toString(36).slice(2)}@instantbooking.local`;
      const esc = (s)=> String(s||"").replace(/[\n\r]/g,"\\n");
      return [
        "BEGIN:VCALENDAR",
        "VERSION:2.0",
        "PRODID:-//InstantBooking//EN",
        "BEGIN:VEVENT",
        `UID:${uid}`,
        `DTSTAMP:${startISO}`,
        `DTSTART:${startISO}`,
        `DTEND:${endISO}`,
        `SUMMARY:${esc(title)}`,
        `DESCRIPTION:${esc(description)}`,
        `LOCATION:${esc(location)}`,
        `ORGANIZER:MAILTO:${organizer}`,
        "END:VEVENT",
        "END:VCALENDAR"
      ].join("\r\n");
    }
    function makeBlobUrl(text){
      const blob = new Blob([text], {type:"text/calendar;charset=utf-8"});
      return URL.createObjectURL(blob);
    }

    // Footer year + contact links
    document.getElementById("year").textContent = new Date().getFullYear();
    document.getElementById("bizPhoneLink").href = `tel:${CONFIG.businessPhoneE164}`;
    document.getElementById("bizEmailLink").href = `mailto:${CONFIG.businessEmail}`;

    // Initial route
    showSectionFromHash();
  </script>
</body>
</html>
